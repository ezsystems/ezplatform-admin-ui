!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ezPluginEmbed=t():(e.eZ=e.eZ||{},e.eZ.ezAlloyEditor=e.eZ.ezAlloyEditor||{},e.eZ.ezAlloyEditor.ezPluginEmbed=t())}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=61)}({61:function(e,t,n){"use strict";var i=n(62),r=function(e){return e&&e.__esModule?e:{default:e}}(i);!function(e){CKEDITOR.plugins.get("ezembed")&&CKEDITOR.plugins.get("ezembedinline")||(CKEDITOR.plugins.add("ezembed",{requires:"widget,ezaddcontent",init:function(e){e.ezembed={canBeAdded:function(){var t=e.elementPath();return!t||null===t.contains("table",!0)}};var t=Object.assign({},r.default,{editor:e});e.widgets.add("ezembed",t)}}),CKEDITOR.plugins.add("ezembedinline",{requires:"widget,ezaddcontent",init:function(e){var t=Object.assign({},r.default,{editor:e,defaults:{href:"ezcontent://",content:"home",view:"embed-inline"},template:'<span data-ezelement="ezembedinline" data-href="{href}" data-ezview="{view}">{content}</span>',requiredContent:"span",upcast:function(e){return"span"===e.name&&"ezembedinline"===e.attributes["data-ezelement"]},insertWrapper:function(e){this.editor.insertHtml("&#8203;"),this.editor.insertElement(e)},createEmbedPreviewNode:function(){return document.createElement("span")}});e.widgets.add("ezembedinline",t)}}))}(window)},62:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={defaults:{href:"ezcontent://",content:"home",view:"embed"},draggable:!1,template:'<div data-ezelement="ezembed" data-href="{href}" data-ezview="{view}">{content}</div>',requiredContent:"div",upcast:function(e){return"div"===e.name&&"ezembed"===e.attributes["data-ezelement"]},insertWrapper:function(e){this.editor.eZ.appendElement(e)},insert:function(){var e=CKEDITOR.dom.element.createFromHtml(this.template.output(this.defaults)),t=this.editor.widgets.wrapElement(e,this.name);this.editor.widgets.initOn(e,this.name),this.insertWrapper(t);var n=this.editor.widgets.getByElement(t);n.ready=!0,n.fire("ready"),n.focus()},edit:function(){this.insert()},init:function(){this.on("focus",this.fireEditorInteraction),this.syncAlignment(),this.getEzConfigElement(),this.setWidgetContent(""),this.cancelEditEvents(),this.initEditMode()},initEditMode:function(){var e=this.getHref().replace("ezcontent://","");e&&this.loadContent(e)},loadContent:function(e){var t=document.querySelector('meta[name="CSRF-Token"]').content,n=document.querySelector('meta[name="SiteAccess"]').content,i=JSON.stringify({ViewInput:{identifier:"embed-load-content-info-"+e,public:!1,ContentQuery:{Criteria:{},FacetBuilders:{},SortClauses:{},Filter:{ContentIdCriterion:""+e},limit:1,offset:0}}}),r=new Request("/api/ezp/v2/views",{method:"POST",headers:{Accept:"application/vnd.ez.api.View+json; version=1.1","Content-Type":"application/vnd.ez.api.ViewInput+json; version=1.1","X-Siteaccess":n,"X-CSRF-Token":t},body:i,mode:"same-origin",credentials:"same-origin"});fetch(r).then(function(e){return e.json()}).then(this.handleContentLoaded.bind(this)).catch(function(e){return window.eZ.helpers.notification.showErrorNotification(e)})},loadImageVariation:function(e){var t=this,n=document.querySelector('meta[name="CSRF-Token"]').content,i=document.querySelector('meta[name="SiteAccess"]').content,r=new Request(e,{method:"GET",headers:{Accept:"application/vnd.ez.api.ContentImageVariation+json","X-Siteaccess":i,"X-CSRF-Token":n},credentials:"same-origin",mode:"same-origin"});fetch(r).then(function(e){return e.json()}).then(function(e){return t.renderEmbedImagePreview(e.ContentImageVariation.uri)})},findEzimageField:function(e){return e.find(function(e){return"ezimage"===e.fieldTypeIdentifier})},handleContentLoaded:function(e){var t=this.element.$.classList.contains("ez-embed-type-image"),n=e.View.Result.searchHits.searchHit[0].value.Content;if(t){var i=this.findEzimageField(n.CurrentVersion.Version.Fields.field);if(!i||!i.fieldValue)return void this.renderEmbedPreview(n.Name);var r=this.getConfig("size"),o=i.fieldValue.variations[r].href;this.variations=i.fieldValue.variations,this.loadImageVariation(o)}else this.renderEmbedPreview(n.Name)},loadImagePreviewFromCurrentVersion:function(e,t){var n=this,i=document.querySelector('meta[name="CSRF-Token"]').content,r=document.querySelector('meta[name="SiteAccess"]').content,o=new Request(e,{method:"GET",headers:{Accept:"application/vnd.ez.api.Version+json","X-Siteaccess":r,"X-CSRF-Token":i},credentials:"same-origin",mode:"same-origin"});fetch(o).then(function(e){return e.json()}).then(function(e){var i=n.findEzimageField(e.Version.Fields.field);if(!i||!i.fieldValue)return t=t||"",void n.renderEmbedPreview(t);var r=n.getConfig("size"),o=i.fieldValue.variations[r].href;n.variations=i.fieldValue.variations,n.loadImageVariation(o)})},createEmbedPreviewNode:function(){return document.createElement("p")},createEmbedPreview:function(e){return'\n            <svg class="ez-icon ez-icon--medium ez-icon--secondary">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/bundles/ezplatformadminui/img/ez-icons.svg#tag"></use>\n            </svg>\n            <span class="ez-embed-content__title">'+e+"</span>\n        "},renderEmbedPreview:function(e){var t=this.createEmbedPreviewNode(),n=this.createEmbedPreview(e);t.classList.add("ez-embed-content"),t.innerHTML=n,this.setWidgetContent(t),this.element.hasClass("is-linked")&&this.renderLinkedIcon()},renderEmbedImagePreview:function(e){var t=document.createElement("img");t.setAttribute("src",e),this.setWidgetContent(t)},cancelEditEvents:function(){var e=function(e){return e.cancel()};this.on("doubleclick",e,null,null,5),this.on("key",e,null,null,5)},syncAlignment:function(){var e=this.element.data("ezalign");e?this._setAlignment(e):this._unsetAlignment()},_setAlignment:function(e){this.wrapper.data("ezalign",e),this.element.data("ezalign",e)},setAlignment:function(e){this._setAlignment(e),this.fireEditorInteraction("setAlignment"+e)},_unsetAlignment:function(){this.wrapper.data("ezalign",!1),this.element.data("ezalign",!1)},unsetAlignment:function(){this._unsetAlignment(),this.fireEditorInteraction("unsetAlignment")},isAligned:function(e){return this.wrapper.data("ezalign")===e},setImageType:function(){return this.element.addClass("ez-embed-type-image"),this},isImage:function(){return this.element.hasClass("ez-embed-type-image")},setHref:function(e){return this.element.data("href",e),this},getHref:function(){return this.element.data("href")},setWidgetContent:function(e){for(var t=this.element.getFirst(),n=void 0;t;)n=t.getNext(),t.data&&t.data("ezelement")||t.remove(),t=n;return e instanceof CKEDITOR.dom.node?this.element.append(e):this.element.appendText(e),this},moveAfter:function(e){this.wrapper.insertAfter(e),this.fireEditorInteraction("moveAfter")},moveBefore:function(e){this.wrapper.insertBefore(e),this.fireEditorInteraction("moveBefore")},setConfig:function(e,t){var n=this.getValueElement(e);return n||(n=new CKEDITOR.dom.element("span"),n.data("ezelement","ezvalue"),n.data("ezvalue-key",e),this.getEzConfigElement().append(n)),n.setText(t),this},getConfig:function(e){var t=this.getValueElement(e);return t?t.getText():void 0},getValueElement:function(e){return this.element.findOne('[data-ezelement="ezvalue"][data-ezvalue-key="'+e+'"]')},getEzConfigElement:function(){var e=this.element.findOne('[data-ezelement="ezconfig"]');return e||(e=new CKEDITOR.dom.element("span"),e.data("ezelement","ezconfig"),this.element.append(e,!0)),e},getEzLinkElement:function(){var e=this.element.findOne('[data-ezelement="ezlink"]');return e||(e=new CKEDITOR.dom.element("a"),e.$.innerHTML=" ",e.setAttribute("data-ezelement","ezlink"),e.setAttribute("data-ez-temporary-link",!0),this.element.append(e)),e},getEzLinkAttribute:function(e){return this.getEzLinkElement().getAttribute(e)},setEzLinkAttribute:function(e,t){this.getEzLinkElement().setAttribute(e,t)},removeEzLinkAttribute:function(e){this.getEzLinkElement().removeAttribute(e)},setLinkEditState:function(){this.element.setAttribute("data-show-edit-link-toolbar",!0)},removeLinkEditState:function(){this.element.removeAttribute("data-show-edit-link-toolbar")},isEditingLink:function(){return this.element.hasAttribute("data-show-edit-link-toolbar")},setIsLinkedState:function(){this.element.$.classList.add("is-linked"),this.renderLinkedIcon()},removeIsLinkedState:function(){this.element.$.classList.remove("is-linked"),this.removeLinkedIcon()},renderLinkedIcon:function(){var e=new CKEDITOR.dom.element("span");this.element.findOne(".ez-embed__icon-wrapper")||(e.$.classList.add("ez-embed__icon-wrapper"),e.$.innerHTML='\n            <svg class="ez-icon ez-icon--medium ez-icon--light">\n                <use xlink:href="/bundles/ezplatformadminui/img/ez-icons.svg#link"></use>\n            </svg>\n        ',this.element.append(e))},removeLinkedIcon:function(){var e=this.element.findOne(".ez-embed__icon-wrapper");e&&e.remove()},fireEditorInteraction:function(e){var t=this.getWrapperRegion(),n=e.name||e,i={editor:this.editor,target:this.element.$,name:"widget"+n,pageX:t.left,pageY:t.top+t.height};this.editor.focus(),this.focus(),this.editor.fire("editorInteraction",{nativeEvent:i,selectionData:{element:this.element,region:t}})},getWrapperRegion:function(){var e=this.wrapper.getWindow().getScrollPosition(),t=this.wrapper.getClientRect();return t.top+=e.y,t.bottom+=e.y,t.left+=e.x,t.right+=e.x,t.direction=CKEDITOR.SELECTION_TOP_TO_BOTTOM,t}};t.default=i}}).default});
//# sourceMappingURL=ezPluginEmbed.js.map