!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ezPluginCustomTag=t():(e.eZ=e.eZ||{},e.eZ.ezAlloyEditor=e.eZ.ezAlloyEditor||{},e.eZ.ezAlloyEditor.ezPluginCustomTag=t())}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=64)}({64:function(e,t,n){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var r=function(){function e(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(e){CKEDITOR.plugins.get("ezcustomtag")||CKEDITOR.plugins.add("ezcustomtag",{requires:"widget,ezaddcontent",init:function(t){t.widgets.add("ezcustomtag",{defaults:{name:"customtag",content:""},draggable:!1,template:'<div class="ez-custom-tag ez-custom-tag--attributes-visible" data-ezelement="eztemplate" data-ezname="{name}"><div data-ezelement="ezcontent">{content}</div></div>',requiredContent:"div",editables:{content:{selector:'[data-ezelement="ezcontent"]'}},setNameFireEditorInteractionTimeout:null,setAlignmentFireEditorInteractionTimeout:null,unsetAlignmentFireEditorInteractionTimeout:null,setConfigFireEditorInteractionTimeout:null,clearConfigFireEditorInteractionTimeout:null,upcast:function(e){return"div"===e.name&&"eztemplate"===e.attributes["data-ezelement"]&&!e.attributes["data-eztype"]},insert:function(){var e,n=CKEDITOR.dom.element.createFromHtml(this.template.output(this.defaults)),i=t.widgets.wrapElement(n,this.name),r=new CKEDITOR.dom.documentFragment(i.getDocument());r.append(i),t.widgets.initOn(n,this.name),t.eZ.appendElement(i),e=t.widgets.getByElement(i),e.ready=!0,e.fire("ready"),e.focus()},edit:function(){this.insert()},init:function(){this.on("focus",this.fireEditorInteraction),this.syncAlignment(),this.renderAttributes(),this.renderHeader(),this.getEzContentElement(),this.getEzConfigElement(),this.cancelEditEvents(),this.toggleState({currentTarget:{dataset:{target:"attributes"}}})},clearNode:function(e){for(var t=e.getFirst(),n=void 0;t;)n=t.getNext(),t.remove(),t=n},renderHeader:function(){var t=e.eZ.adminUiConfig.richTextCustomTags[this.getName()];if(t){var n=this.getHeader(),i='\n                            <div class="ez-custom-tag__header-label">\n                                '+t.label+'\n                            </div>\n                            <div class="ez-custom-tag__header-btns">\n                                <button class="btn ez-custom-tag__header-btn ez-custom-tag__header-btn--attributes" data-target="attributes">\n                                    <svg class="ez-icon ez-icon--small">\n                                        <use xlink:href="/bundles/ezplatformadminui/img/ez-icons.svg#list"></use>\n                                    </svg>\n                                </button>\n                                <button class="btn ez-custom-tag__header-btn ez-custom-tag__header-btn--content" data-target="content">\n                                    <svg class="ez-icon ez-icon--small">\n                                        <use xlink:href="/bundles/ezplatformadminui/img/ez-icons.svg#edit"></use>\n                                    </svg>\n                                </button>\n                            </div>\n                    ';this.clearNode(n),n.appendHtml(i),this.attachButtonsListeners()}},attachButtonsListeners:function(){var e=this,t=this.getHeader();[t.findOne(".ez-custom-tag__header-btn--attributes"),t.findOne(".ez-custom-tag__header-btn--content")].forEach(function(t){return t.$.addEventListener("click",e.toggleState.bind(e),!1)})},toggleState:function(e){var t=this,n=e.currentTarget.dataset.target,i={attributes:"ez-custom-tag--attributes-visible",content:"ez-custom-tag--content-visible"};Object.entries(i).forEach(function(e){var i=r(e,2),o=i[0],a=i[1];return t.element.$.classList.toggle(a,o===n)})},renderAttributes:function(){var t=this,n=e.eZ.adminUiConfig.richTextCustomTags[this.getName()];if(n){var i=Object.keys(n.attributes).reduce(function(e,i){var r=t.getConfig(i);return e+"<p>"+n.attributes[i].label+": "+r+"</p>"},"");this.setWidgetAttributes(i)}},setName:function(e){return this.element.data("ezname",e),window.clearTimeout(this.setNameFireEditorInteractionTimeout),this.setNameFireEditorInteractionTimeout=window.setTimeout(this.fireEditorInteraction.bind(this,"nameUpdated"),50),this},getName:function(){return this.element.data("ezname")},cancelEditEvents:function(){var e=function(e){return e.cancel()};this.on("doubleclick",e,null,null,5),this.on("key",e,null,null,5)},syncAlignment:function(){var e=this.element.data("ezalign");e?this.setAlignment(e):this.unsetAlignment()},setAlignment:function(e){this.wrapper.data("ezalign",e),this.element.data("ezalign",e),window.clearTimeout(this.setAlignmentFireEditorInteractionTimeout),this.setAlignmentFireEditorInteractionTimeout=window.setTimeout(this.fireEditorInteraction.bind(this,"aligmentUpdated"),50)},unsetAlignment:function(){this.wrapper.data("ezalign",!1),this.element.data("ezalign",!1),window.clearTimeout(this.unsetAlignmentFireEditorInteractionTimeout),this.unsetAlignmentFireEditorInteractionTimeout=window.setTimeout(this.fireEditorInteraction.bind(this,"aligmentRemoved"),50)},isAligned:function(e){return this.wrapper.data("ezalign")===e},setWidgetContent:function(e){for(var t=this.getEzContentElement(),n=t.getFirst(),i=void 0;n;)i=n.getNext(),n.remove(),n=i;return e instanceof CKEDITOR.dom.node?t.append(e):t.appendHtml(e),this},setConfig:function(e,t){var n=this.getValueElement(e);return n||(n=new CKEDITOR.dom.element("span"),n.data("ezelement","ezvalue"),n.data("ezvalue-key",e),this.getEzConfigElement().append(n)),n.setText(t),window.clearTimeout(this.setConfigFireEditorInteractionTimeout),this.setConfigFireEditorInteractionTimeout=window.setTimeout(this.fireEditorInteraction.bind(this,"configUpdated"),50),this},setWidgetAttributes:function(e){for(var t=this.getEzAttributesElement(),n=t.getFirst(),i=void 0;n;)i=n.getNext(),n.remove(),n=i;return e instanceof CKEDITOR.dom.node?t.append(e):t.appendHtml(e),this},getConfig:function(e){var t=this.getValueElement(e);return t?t.getText():""},clearConfig:function(){for(var e=this.getEzConfigElement();e.firstChild;)e.removeChild(e.firstChild);window.clearTimeout(this.clearConfigFireEditorInteractionTimeout),this.clearConfigFireEditorInteractionTimeout=window.setTimeout(this.fireEditorInteraction.bind(this,"configCleared"),50)},getValueElement:function(e){return this.getEzConfigElement().findOne('[data-ezelement="ezvalue"][data-ezvalue-key="'+e+'"]')},getEzConfigElement:function(){var e=[].concat(i(this.element.getChildren().$)).find(function(e){return"ezconfig"===e.dataset.ezelement});return e?e=new CKEDITOR.dom.element(e):(e=new CKEDITOR.dom.element("span"),e.data("ezelement","ezconfig"),this.element.append(e)),e},getEzContentElement:function(){var e=[].concat(i(this.element.getChildren().$)).find(function(e){return"ezcontent"===e.dataset.ezelement});return e?e=new CKEDITOR.dom.element(e):(e=new CKEDITOR.dom.element("div"),e.data("ezelement","ezcontent"),this.element.append(e)),e},getEzAttributesElement:function(){var e=[].concat(i(this.element.getChildren().$)).find(function(e){return"ezattributes"===e.dataset.ezelement});return e?e=new CKEDITOR.dom.element(e):(e=new CKEDITOR.dom.element("div"),e.data("ezelement","ezattributes"),this.element.append(e,!0)),e},getHeader:function(){var e=[].concat(i(this.element.getChildren().$)).find(function(e){return e.classList.contains("ez-custom-tag__header")});return e?e=new CKEDITOR.dom.element(e):(e=new CKEDITOR.dom.element("div"),e.addClass("ez-custom-tag__header"),this.element.append(e,!0)),e},fireEditorInteraction:function(e){var n=this.getWrapperRegion(),i=e.name||e,r={editor:t,target:this.element.$,name:"widget"+i,pageX:n.left,pageY:n.top+n.height};t.focus(),this.focus(),t.fire("editorInteraction",{nativeEvent:r,selectionData:{element:this.element,region:n}})},moveAfter:function(e){this.wrapper.insertAfter(e),this.fireEditorInteraction("moveAfter")},moveBefore:function(e){this.wrapper.insertBefore(e),this.fireEditorInteraction("moveBefore")},getWrapperRegion:function(){var e=this.wrapper.getWindow().getScrollPosition(),t=this.wrapper.getClientRect();return t.top+=e.y,t.bottom+=e.y,t.left+=e.x,t.right+=e.x,t.direction=CKEDITOR.SELECTION_TOP_TO_BOTTOM,t}})}})}(window)}}).default});
//# sourceMappingURL=ezPluginCustomTag.js.map