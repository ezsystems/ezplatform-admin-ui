{% trans_default_domain 'locationview' %}

{% import _self as macros %}

<div class="ez-scrollable-table-wrapper">
    <table class="table table-hover">
        <thead>
        <tr>
            <th>{{ 'tab.relations.table.name'|trans()|desc('Name') }}</th>
            <th>{{ 'tab.relations.table.content_type'|trans()|desc('Content type') }}</th>
            <th>{{ 'tab.relations.table.relation_type'|trans()|desc('Relation type') }}</th>
        </tr>
        </thead>
        <tbody>
            {% if relations is not empty %}
                {% for relation in relations %}
                    {% if relation.isAccessible %}
                        {% set source = relation.sourceContentInfo %}
                        <tr>
                            <td>
                                {% if source.mainLocationId is not null %}
                                    <a href="{{ path('_ez_content_view',
                                        { 'contentId': source.id, 'locationId': relation.resolvedSourceLocation.id }) }}"
                                    >
                                        {{ ez_content_name(source) }}
                                    </a>
                                {% else %}
                                    {{ ez_content_name(source) }}
                                {% endif %}
                            </td>
                            <td>{{ content_types[source.contentTypeId].name }}</td>
                            <td>
                                {{ macros.relation_type(relation) }}
                                {% if (relation.relationFieldDefinitionName) %}
                                    ({{ relation.relationFieldDefinitionName }})
                                {% endif %}
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td class="table__cell ez-table__cell--has-text-info" colspan="8">
                                {{
                                    'dashboard.table.relation.unauthorized'|trans({
                                        '%module%': relation.unauthorizedRelation.module,
                                        '%function%': relation.unauthorizedRelation.function,
                                        '%contentId%': relation.unauthorizedRelation.payload.contentId,
                                    })|desc('You do not have the \'%function%\' \'%module%\' permission for content ID: %contentId%')
                                }}
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            {% else %}
                <tr>
                    <td class="ez-table__cell ez-table__cell--no-content" colspan="3">
                        <p class="ez-table-no-content mb-0 py-0">
                            {{ 'tab.relations.no_reverse_relations'|trans()|desc('This Content item has no reverse Relations.') }}
                        </p>
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

{% macro relation_type(relation) %}
    {% if relation.type == constant('eZ\\Publish\\API\\Repository\\Values\\Content\\Relation::COMMON') %}
        {{ 'tab.relations.table.relation_type.content_level_relation'|trans()|desc('Content level relation') }}
    {% elseif relation.type == constant('eZ\\Publish\\API\\Repository\\Values\\Content\\Relation::EMBED') %}
        {{ 'tab.relations.table.relation_type.embed'|trans()|desc('Embed') }}
    {% elseif relation.type == constant('eZ\\Publish\\API\\Repository\\Values\\Content\\Relation::LINK') %}
        {{ 'tab.relations.table.relation_type.link'|trans()|desc('Link') }}
    {% else %}
        {{ 'tab.relations.table.relation_type.field'|trans()|desc('Field') }}
    {% endif %}
{% endmacro %}
