{%- block choice_widget -%}
    {% set choices = form.vars.choices
        | map(choice => choice.choices is defined ? choice.choices : [choice])
        | reduce((carry, choices) => carry|merge(choices), [])
    %}
    {% set attr = attr|default({})|merge({
        'class': (attr.class|default('') ~ ' ibexa-input ibexa-input--select')|trim,
    }) %}
    {% set source %}
        {% if expanded %}
            {{- block('choice_widget_expanded') -}}
        {% else %}
            {{- block('choice_widget_collapsed') -}}
        {% endif %}
    {% endset %}

    {% include '@ezdesign/ui/component/dropdown.html.twig' with {
        source: source,
        choices: choices,
        value: form.vars.value,
        multiple: form.vars.multiple,
        choice_translation_domain: false
    } %}
{%- endblock choice_widget -%}
