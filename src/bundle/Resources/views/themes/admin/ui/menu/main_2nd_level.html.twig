{% extends '@ezdesign/ui/menu/top_menu_base.html.twig' %}

{% block root %}
    {% set list_attributes = item.childrenAttributes %}
    {% set current_item = item %}

    <div class="tab-content ibexa-main-menu__tab-content">
        {% for child in current_item.children %}
            <div class="tab-pane fade ibexa-main-menu__tab-pane {% if loop.index == 2 %}show active{% endif %}" id="{{ child.name }}">
                <ul class="ibexa-main-menu__items-list">
                    {% for item in child.children %}
                        {{ block('item') }}
                    {% endfor %}

                    <li class="ibexa-main-menu__item ibexa-main-menu__item--tooltip-trigger">
                        <button 
                            class="ibexa-main-menu__tooltip-trigger ibexa-btn ibexa-btn--small ibexa-btn--no-text ibexa-btn--neon-info"
                            data-popup-target-selector="#{{ child.name }}-popup"
                        >
                            <svg class="ibexa-icon ibexa-icon--small">
                                <use xlink:href="{{ ibexa_icon_path('column-one') }}"></use>
                            </svg>
                        </button>

                        <ul id="{{ child.name }}-popup" class="ibexa-main-menu__popup ibexa-main-menu__popup--hidden">
                            {% for item in child.children %}
                                {{ block('item') }}
                            {% endfor %}
                        </ul>
                    </li>
                </ul>
            </div>
        {% endfor %}
    </div>
    
    <div class="ibexa-main-menu__toggler-container">
        <button 
            class="ibexa-main-menu__toggler ibexa-btn ibexa-btn--small ibexa-btn--no-text ibexa-btn--neon-info" 
            data-toggle-target-selector=".ibexa-main-menu__navbar--second-level"
            data-toggler-level="2"
        >
            <svg class="ibexa-icon ibexa-icon--small">
                <use xlink:href="{{ ibexa_icon_path('caret-back') }}"></use>
            </svg>
        </button>
    </div>
{% endblock %}

{% block linkElement %}
    {% import 'knp_menu.html.twig' as knp_menu %}
    
    {% set classes = [
        'ibexa-main-menu__item-action',
        'ibexa-main-menu__item-action--second-level',
        (matcher.isCurrent(item) ? options.currentClass|trim),
        (item.linkAttributes.class is defined ?  item.linkAttributes.class|trim)
    ] %}

    {% set linkAttributes = {
        'href': item.uri,
        'aria-controls': item.name,
        'class': classes|join(' ')
    } %}

    {% if item.extras.title is defined %}
        {% set linkAttributes = linkAttributes|merge({
            'title': item.extras.title
        })  %}
    {% endif %}

    {% set link_attributes = item.linkAttributes|merge(linkAttributes) %}

    <a{{ knp_menu.attributes(link_attributes) }}>
        <div class="ibexa-main-menu__item-text-column">{{ block('label') }}</div>
    </a>
{% endblock %}

{% block spanElement %}
    {{ block('linkElement') }}
{% endblock %}


