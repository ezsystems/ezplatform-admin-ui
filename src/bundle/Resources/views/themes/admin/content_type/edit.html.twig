{% extends "@ezdesign/content_type/edit_base.html.twig" %}

{% block header %}
    {% set content_type_edit_sidebar_right = knp_menu_get('ezplatform_admin_ui.menu.content_type_edit.sidebar_right', [], {
        'form_view': form, 
        'content_type': content_type
    }) %}

    {% include '@ezdesign/ui/edit_header.html.twig' with {
        action_name: 'creating'|trans|desc('Creating'),
        icon_name: 'content-type',
        title: 'content_type.breadcrumb.create'|trans|desc('Creating a new Content Type'),
        show_autosave_status: false,
        buttons_render: knp_menu_render(content_type_edit_sidebar_right, {'template': '@ezdesign/ui/menu/context_menu.html.twig'})
    } %}
{% endblock %}

{% block form %}
    {{ form_start(form) }}
        {# ==== Grouped fields ==== #}
        {% set metadataGroup = [] %}
        {% set contentGroup = [] %}

        {% for field_definition in form.fieldDefinitionsData %}
            {% set value = field_definition.vars.value %}
            {% if value.fieldGroup == 'metadata' %}
                {% set metadataGroup = metadataGroup|merge([field_definition])  %}
            {% else %}
                {% set contentGroup = contentGroup|merge([field_definition])  %}
            {% endif %}
        {% endfor %}

        {% set fields = {
            'content':contentGroup,
            'metadata': metadataGroup
        } %}
        {# ==== end grouped fields ==== #}


        {% set language_code = language_code|default(content_type.mainLanguageCode) %}
        {% set is_translation = form.vars.data.languageCode != content_type.mainLanguageCode %}
        
        {% if is_translation %}
            {% include '@ezdesign/content_type/part/nontranslatable_fields_disabled.html.twig' %}
        {% endif %}

        <div class="ibexa-content-type-edit__sections ibexa-anchor-navigation-sections container">
            {% embed "@ezdesign/content_type/edit-section.html.twig" with { section_id: '#Global-properties' } %}
                {% block title %}
                    {{ 'content_type.view.edit.global_properties'|trans|desc('Global properties') }}
                {% endblock %}

                {% block left_column %}
                    {# {{ form_row(form.name, {'label_attr': {'class': 'ez-label'}}) }}
                    {{ form_row(form.identifier, {'label_attr': {'class': 'ez-label'}}) }}
                    {{ form_row(form.description, {'label_attr': {'class': 'ez-label'}}) }}
                    {{ form_row(form.nameSchema, {'label_attr': {'class': 'ez-label'}}) }}
                    {{ form_row(form.urlAliasSchema, {'label_attr': {'class': 'ez-label'}}) }}
                    {{ form_row(form.isContainer, {'label_attr': {'class': 'ez-label'}}) }}
                    {{ form_row(form.defaultSortField, {'label_attr': {'class': 'ez-label'}}) }}
                    {{ form_row(form.defaultSortOrder, {'label_attr': {'class': 'ez-label'}}) }}
                    {{ form_row(form.defaultAlwaysAvailable, {'label_attr': {'class': 'ez-label'}}) }} #}
                {% endblock %}
            {% endembed %}
            
            {% embed "@ezdesign/content_type/edit-section.html.twig" with { 
                    section_id: '#Field-definitions',
                    is_active: true,
                    left_column_class: 'ibexa-content-type-edit__section-column--field-definitions'
            } %}
                {% block title %}
                    {{ 'content_type.view.edit.content_field_definitions'|trans|desc('Field definitions') }}
                {% endblock %}

                {% block left_column %}
                    {{ include('@ezdesign/content_type/field_definitions.html.twig', { grouped_fields: fields }) }}
                {% endblock %}

                {% block right_column %}
                    {{ include('@ezdesign/content_type/available_field_types.html.twig') }}
                {% endblock %}
            {% endembed %}

            {# <div 
                data-anchor-section-id="#Field-definitions" 
                class="ibexa-anchor-navigation-sections__section ibexa-anchor-navigation-sections__section--active row"
            >
                <div class="col-8 ibexa-content-type-edit__section-column ibexa-content-type-edit__section-column--field-definitions">
                    <h2 class="ibexa-content-type-edit__section-header">{{ 'content_type.view.edit.content_field_definitions'|trans|desc('Field definitions') }}</h2>
                    <div class="ibexa-content-type-edit__add-group">
                        <button class="ibexa-content-type-edit__add-button btn ibexa-btn ibexa-btn ibexa-btn--info">
                            <svg class="ibexa-icon ibexa-icon--small">
                                <use xlink:href="{{ ibexa_icon_path('create') }}"></use>
                            </svg>
                            {{ 'content_type.view.edit.add'|trans|desc('Add') }}
                        </button>
                    </div> #}
                    
                    
                    {# <a 
                        class="btn btn-primary" 
                        data-toggle="collapse" 
                        href="#multiCollapseExample1" 
                    >
                        Toggle first element
                    </a>
                    <div class="collapse multi-collapse" id="multiCollapseExample1">
                        <div class="card card-body">
                            Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident.
                        </div>
                    </div> #}

                    {# <div class="ibexa-content-type-edit-content__field-groups"> #}
                        {# {% for group in fields %}
                            {% if group|length %}
                                <div class="card ez-card ez-card--toggle-group ez-card--collapsed">
                                    <div class="ez-card__header">
                                        <button class="ez-card__body-display-toggler btn">
                                            <svg class="ibexa-icon ibexa-icon--small ibexa-icon--caret-down" aria-hidden="true">
                                                <use xlink:href="{{ ibexa_icon_path('caret-down') }}"></use>
                                            </svg>
                                            <svg class="ibexa-icon ibexa-icon--small ibexa-icon--caret-next" aria-hidden="true">
                                                <use xlink:href="{{ ibexa_icon_path('caret-next') }}"></use>
                                            </svg>
                                        </button>
                                    </div>

                                    <div class="ez-card__body">
                                        aaaa
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div> #}
                {# </div>
                <div class="col-4 ibexa-content-type-edit__section-column ibexa-content-type-edit__section-column--available-fields">
                </div>
            </div> #}
        </div>
        
        {{ form_widget(form.publishContentType, {'attr': { 'hidden': 'hidden' }}) }}
        {{ form_widget(form.removeDraft, {'attr': { 'hidden': 'hidden' }}) }}

        {{ form_widget(form._token) }}
    {{ form_end(form, {'render_rest': false }) }}
{% endblock %}

{# {% block body_class %}ez-admin-edit{% endblock %}

{% block breadcrumbs_admin %}
    {% include '@ezdesign/ui/breadcrumbs.html.twig' with { items: [
        { value: 'breadcrumb.admin'|trans(domain='messages')|desc('Admin') },
        { url: path('ezplatform.content_type_group.list'), value: 'content_type_group.breadcrumb.list'|trans|desc('Content Types') },
        { url: path('ezplatform.content_type_group.view', { contentTypeGroupId: content_type_group.id }), value: 'content_type_group.breadcrumb.view'|trans({ '%identifier%': content_type_group.identifier })|desc('%identifier%') },
        { value: 'content_type.breadcrumb.edit'|trans({ '%identifier%': content_type.name })|desc('%identifier%') }
    ]} %}
{% endblock %}

{% block page_title_admin %}
    {% include '@ezdesign/ui/page_title.html.twig' with {
        title: 'content_type.view.edit.title'|trans({ '%name%': content_type.name })|desc('Editing Content Type \'%name%\''),
        content_type_identifier: content_type.identifier
    } %}
{% endblock %}

{% block form %}
    {{ form_start(form) }}
    {% set language_code = language_code|default(content_type.mainLanguageCode) %}
    {% set is_translation = form.vars.data.languageCode != content_type.mainLanguageCode %}
    {% if is_translation %}
        {% include '@ezdesign/content_type/part/nontranslatable_fields_disabled.html.twig' %}
    {% endif %}
    <section class="container ez-container mb-4">
        <div class="card ibexa-card ibexa-card--light">
            <div class="ibexa-card__header ibexa-card__header--section-title">
                {{ 'content_type.view.edit.global_properties'|trans|desc('Global properties') }}
            </div>
            <div class="card-body ibexa-card__body ibexa-card__body--incresed-margin">
                {{ form_row(form.name, {'label_attr': {'class': 'ez-label'}}) }}
                {{ form_row(form.identifier, {'label_attr': {'class': 'ez-label'}}) }}
                {{ form_row(form.description, {'label_attr': {'class': 'ez-label'}}) }}
                {{ form_row(form.nameSchema, {'label_attr': {'class': 'ez-label'}}) }}
                {{ form_row(form.urlAliasSchema, {'label_attr': {'class': 'ez-label'}}) }}
                {{ form_row(form.isContainer, {'label_attr': {'class': 'ez-label'}}) }}
                {{ form_row(form.defaultSortField, {'label_attr': {'class': 'ez-label'}}) }}
                {{ form_row(form.defaultSortOrder, {'label_attr': {'class': 'ez-label'}}) }}
                {{ form_row(form.defaultAlwaysAvailable, {'label_attr': {'class': 'ez-label'}}) }}
            </div>
        </div>
    </section>

    <section class="container ez-container">
        <div class="card ibexa-card ibexa-card--light">
            <div class="ibexa-card__header ibexa-card__header--sticky-top ibexa-card__header--section-title">
                <div>
                    {{ 'content_type.view.edit.content_field_definitions'|trans|desc('Field definitions') }}
                </div>
                <div class="form-inline">
                    <div class="ibexa-card__field-control mr-2">
                    {{ form_widget(form.fieldTypeSelection, {'attr': {'class': 'ez-field-selection'}}) }}
                    {{ form_widget(form.addFieldDefinition, {'attr': {'class': 'btn ibexa-btn ibexa-btn--secondary'}}) }}
                    </div>

                    <button type="button"
                            title="{{ 'content_type.view.edit.content_field_definition.delete'|trans|desc('Delete Field definition(s)') }}"
                            class="btn ibexa-btn ibexa-btn--ghost ibexa-btn--no-text"
                            data-bs-toggle="modal"
                            data-bs-target="#delete-content-type-modal"
                            {% if form.addFieldDefinition.vars.disabled %} disabled {% endif %}>
                        <svg class="ibexa-icon ibexa-icon--small">
                            <use xlink:href="{{ ibexa_icon_path('trash') }}"></use>
                        </svg>
                    </button>
                </div>
            </div>

            {% include '@ezdesign/content_type/modal/delete_confirmation.html.twig' with {'form': form} %}

            <div class="card-body ibexa-card__body ibexa-card__body--incresed-margin">
                {% for field_definition in form.fieldDefinitionsData %}
                    {% set value = field_definition.vars.value %}

                    <div class="card ibexa-card ibexa-card--toggle-group ibexa-card--collapsed">
                        <div id="field-definition-{{ value.identifier }}" class="ibexa-card__header">
                            {% set name = value.names[language_code] ?? value.names[content_type.mainLanguageCode]  %}
                            <button class="ibexa-card__body-display-toggler btn">
                                <svg class="ibexa-icon ibexa-icon--small ibexa-icon--caret-down" aria-hidden="true">
                                    <use xlink:href="{{ ibexa_icon_path('caret-down') }}"></use>
                                </svg>
                                <svg class="ibexa-icon ibexa-icon--small ibexa-icon--caret-next" aria-hidden="true">
                                    <use xlink:href="{{ ibexa_icon_path('caret-next') }}"></use>
                                </svg>
                            </button>
                            {{ form_widget(field_definition.selected, {
                                'label': '%s (%s)'|format(name, value.fieldTypeIdentifier),
                                'attr': {'class': 'mr-1'}
                            }) }}
                        </div>

                        <div class="ibexa-card__body">
                            {{ form_row(field_definition.name, {'label_attr': {'class': 'ez-label'}}) }}
                            {{ form_row(field_definition.identifier, {'label_attr': {'class': 'ez-label'}}) }}
                            {{ form_row(field_definition.position, {'label_attr': {'class': 'ez-label'}}) }}
                            {{ form_row(field_definition.description, {'label_attr': {'class': 'ez-label'}}) }}
                            {{ form_row(field_definition.isRequired, {'label_attr': {'class': 'ez-label'}}) }}
                            {{ form_row(field_definition.isSearchable, {'label_attr': {'class': 'ez-label'}}) }}
                            {{ form_row(field_definition.isTranslatable, {'label_attr': {'class': 'ez-label'}}) }}
                            {{ form_row(field_definition.isThumbnail, {'label_attr': {'class': 'ez-label'}}) }}
                            {{ form_row(field_definition.fieldGroup, {'label_attr': {'class': 'ez-label'}}) }}

                            {# Field type specific fields below #}
                            {# {{ ez_render_field_definition_edit(value, {
                                'languageCode': language_code,
                                'form': field_definition,
                                'group_class': value.group_class|default(''),
                                'is_translation': is_translation,
                            }) }} #}

                            {# Default rendering #}
                            {# {% for child in field_definition|filter(child => child.isRendered() == false) %}
                                {{ form_row(child) }}
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>

    {{ form_widget(form.publishContentType, {'attr': { 'hidden': 'hidden' }}) }}
    {{ form_widget(form.removeDraft, {'attr': { 'hidden': 'hidden' }}) }}

    {{ form_widget(form._token) }}
    {{ form_end(form, {'render_rest': false }) }} #}
{# {% endblock %} #}

{# {% block right_sidebar %} #}
    {# {% set content_type_edit_sidebar_right = knp_menu_get('ezplatform_admin_ui.menu.content_type_edit.sidebar_right', [], {'form_view': form, 'content_type': content_type}) %} #}
    {# {{ knp_menu_render(content_type_edit_sidebar_right, {'template': '@ezdesign/ui/menu/sidebar_right.html.twig'}) }}
{% endblock %} #}

{% block javascripts %}
    {{ encore_entry_script_tags('ezplatform-admin-ui-content-type-edit-js', null, 'ezplatform') }}
{% endblock %}
